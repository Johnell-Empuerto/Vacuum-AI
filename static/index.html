<body>
  <video id="camera" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <script>
    const video = document.getElementById("camera");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // Ask for camera
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    });

    async function sendFrame() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(async blob => {
        const formData = new FormData();
        formData.append("file", blob, "frame.jpg");

        const res = await fetch("/detect", { method: "POST", body: formData });
        const data = await res.json();

        // Draw detections
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        data.detections.forEach(det => {
          const [x1, y1, x2, y2] = det.bbox;
          ctx.strokeStyle = "lime";
          ctx.lineWidth = 2;
          ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
          ctx.fillStyle = "lime";
          ctx.fillText(`${det.label} ${det.confidence.toFixed(2)}`, x1, y1 - 5);
        });
      }, "image/jpeg");
    }

    setInterval(sendFrame, 500); // every 0.5 sec
  </script>
</body>
